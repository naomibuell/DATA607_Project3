---
title: "Project 3 - Naomi to start cleaning job title, location"
author: "Naomi Buell"
date: "`r Sys.Date()`"
output: html_document
---

```{r}
#| label: setup
#| include: false

# load packages
library(dplyr)
library(tidyverse)
library(janitor)
```

Import data from GitHub (currently using placeholder for database data).

```{r import}
csv_link <-
  "https://raw.githubusercontent.com/naomibuell/DATA607_Project3/main/linkedin-jobs-usa.csv"

jobs_raw <- read_csv(csv_link) |>
  janitor::clean_names() |> # auto-cleaning column names using janitor package
  mutate(
    title = as.factor(title),
    location_1 = as.factor(str_extract(location, "[^,]+")),
    # get location before the comma, typically city
    location_2 = as.factor(str_extract(location, "(?<=,\\s).+")) # use REGEX to get location after the comma, typically state
  ) |> 
  select(-c(posted_date, link))

head(jobs_raw)
```

## Title

Levels of title from raw df below. All are data analysts. Some job titles have other information included in the field (e.g., remote/hybrid information).

```{r title-factors}
levels(jobs_raw$title)
```

To be tidy, every cell can only have 1 piece of information. To this end, pull out remote/hybrid details from "title" and verify that this info matches with the existing "onsite_remote" column.

```{r title}

jobs_titles <- jobs_raw |>
  # pull extra detail from "tite" to variable "analyst_detail"
  mutate(
    analyst_detail = title |>
      str_remove("Data Analyst") |>
      str_remove("Data analyst") |>
      str_remove(" - ") |>
      str_trim(),
    # pull details into new column for onsite_remote for QC
    analyst_detail_onsite_remote = str_detect(analyst_detail, "Remote") |
      str_detect(analyst_detail, "remote") |
      str_detect(analyst_detail, "Hybrid") |
      str_detect(analyst_detail, "REMOTE") |
      str_detect(analyst_detail, "WFH") |
      str_detect(analyst_detail, "Onsite"),
    # Remove these details and more from our list of details using REGEX
    title_clean = title |>
      str_replace("analyst", "Analyst") |> # standardize capitalization
      str_remove("Remote") |> # remove remote/onsite qualifiers
      str_remove("remote") |>
      str_remove("Hybrid") |>
      str_remove("REMOTE") |>
      str_remove("WFH") |> 
      str_remove("Onsite")|>
      str_remove("Weekly.*Schedule") |> 
      str_remove("\\(.*\\)") |> # remove parentheticals
      str_remove("\\/.*\\/") |> # remove content within slashes
      str_remove("//") |> # remove other symbols to standardize
      str_remove("!") |>
      str_remove("- $") |> 
      str_replace("  "," ") |> 
      str_trim() |> 
      as.factor()
  )
```

Here are all the values in my cleaned titles column:

```{r titles-clean}
levels(jobs_titles$title_clean)
```

I browsed the data to verify that remote/onsite job title qualifiers matched with specifications in the `remote_onsite` column.

```{r verify-onsite-remote}
jobs_onsite_check <- jobs_titles |> 
  filter(analyst_detail_onsite_remote) |> 
  select(title, onsite_remote) |> 
  unique()

head(jobs_onsite_check, nrow(jobs_onsite_check))
```

I do the same with seniority level, as we have this information in a column elsewhere.

```{r}

```

## Location

Next I work with location, which contains data with varying levels of granularity (e.g., some at state level, some at city level). I make columns consistent by separating data into state and location columns.

```{r location}
# get state names and abbreviations from built-in dataset
states <- data.frame(state.abb, state.name) |>
  rename(location_1 = state.name)

jobs_loc <- jobs_titles |>
  left_join(states) |> # join to get state abbrevs
  mutate(
    state = if_else(location_2 == "United States", state.abb, location_2),
    # gen state (abbreviation) variable
    city = if_else(is.na(state.abb) | location_2 != "United States", location_1, NA)
  )
```

Here are a few of the cities and states in which jobs were posted:

```{r summ-loc}
jobs_loc |> select(city, state) |> unique()
```

Lastly, I'll remove any intermediate variables from the df:

```{r}
jobs_cleaned <- jobs_loc |> 
  select(-c(starts_with("location"), starts_with("analyst"), title, state.abb))
```
